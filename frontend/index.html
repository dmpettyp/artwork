<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artwork - Image Graph Editor</title>
    <link rel="stylesheet" href="/css/main.css">
</head>

<body>
    <div class="app">
        <!-- Top header bar -->
        <div class="top-header">
            <h1 style="margin: 0; font-size: 24px; color: #3498db;">Artwork</h1>
            <select id="graph-select" class="graph-select">
                <option value="">Select a graph...</option>
            </select>
            <div style="display: flex; gap: 10px;">
                <button id="create-graph-btn" class="btn btn-primary">+ New Graph</button>
                <button id="refresh-btn" class="btn">Refresh</button>
            </div>
        </div>

        <div class="main-layout">
            <!-- Main canvas area -->
            <main class="canvas-container">
                <svg id="graph-canvas" class="graph-canvas">
                    <!-- Connections layer -->
                    <g id="connections-layer"></g>
                    <!-- Nodes layer -->
                    <g id="nodes-layer"></g>
                </svg>
            </main>

            <!-- Resize handle -->
            <div id="sidebar-resize-handle" class="resize-handle"></div>

            <!-- Right sidebar for outputs -->
            <aside id="outputs-sidebar" class="outputs-sidebar">
                <div class="sidebar-header">
                    <h2>Outputs</h2>
                </div>
                <div class="sidebar-content">
                    <!-- Output nodes will be listed here -->
                </div>
            </aside>
        </div>
    </div>

    <!-- Modal for creating new graph -->
    <div id="create-graph-modal" class="modal">
        <div class="modal-content">
            <h3>Create New Graph</h3>
            <input type="text" id="graph-name-input" placeholder="Enter graph name" />
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="btn">Cancel</button>
                <button id="modal-create-btn" class="btn btn-primary">Create</button>
            </div>
        </div>
    </div>

    <!-- Modal for adding node -->
    <div id="add-node-modal" class="modal">
        <div class="modal-content">
            <h3 id="add-node-modal-title">Add Node</h3>

            <label for="node-name-input">Node Name</label>
            <input type="text" id="node-name-input" class="form-input" placeholder="Enter node name" />

            <div id="node-image-upload" style="display: none;">
                <label for="node-image-input">Image File</label>
                <input type="file" id="node-image-input" class="form-input" accept="image/*" />
            </div>

            <div id="node-config-fields">
                <!-- Dynamic config fields will be inserted here -->
            </div>

            <div class="modal-actions">
                <button id="add-node-cancel-btn" class="btn">Cancel</button>
                <button id="add-node-create-btn" class="btn btn-primary">Add Node</button>
            </div>
        </div>
    </div>

    <!-- Modal for editing node config -->
    <div id="edit-config-modal" class="modal">
        <div class="modal-content">
            <h3 id="edit-config-modal-title">Edit Node</h3>

            <label for="edit-node-name-input">Name</label>
            <input type="text" id="edit-node-name-input" class="form-input" placeholder="Enter node name" />

            <div id="edit-image-upload" style="display: none;">
                <label for="edit-image-input">Image File (optional - leave empty to keep current)</label>
                <input type="file" id="edit-image-input" class="form-input" accept="image/*" />
            </div>

            <div id="edit-config-fields">
                <!-- Dynamic config fields will be inserted here -->
            </div>

            <div class="modal-actions">
                <button id="edit-config-cancel-btn" class="btn">Cancel</button>
                <button id="edit-config-save-btn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for delete confirmation -->
    <div id="delete-node-modal" class="modal">
        <div class="modal-content">
            <h3>Delete Node</h3>
            <p>Are you sure you want to delete this node?</p>
            <p id="delete-node-name" style="font-weight: bold; color: #2c3e50; margin-top: 10px;"></p>

            <div class="modal-actions">
                <button id="delete-node-cancel-btn" class="btn">Cancel</button>
                <button id="delete-node-confirm-btn" class="btn" style="background: #e74c3c;">Delete</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing node output image -->
    <div id="view-image-modal" class="modal">
        <div class="modal-content modal-image-viewer">
            <h3 id="view-image-title">Node Output</h3>
            <div id="view-image-container" class="image-viewer-container">
                <img id="view-image-img" src="" alt="Node output" />
                <p id="view-image-message" class="image-viewer-message"></p>
            </div>
            <div class="modal-actions">
                <button id="view-image-close-btn" class="btn btn-primary">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for crop node configuration -->
    <div id="crop-modal" class="modal">
        <div class="modal-content modal-crop">
            <h3>Crop Original Image</h3>

            <label for="crop-node-name">Node Name (optional)</label>
            <input type="text" id="crop-node-name" class="form-input" placeholder="Enter node name" />

            <div class="aspect-ratio-container"
                style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                <label for="crop-aspect-width" style="margin: 0;">Aspect Ratio:</label>
                <input type="number" id="crop-aspect-width" class="form-input" min="1" placeholder="w"
                    style="width: 80px;" />
                <span>:</span>
                <input type="number" id="crop-aspect-height" class="form-input" min="1" placeholder="h"
                    style="width: 80px;" />
                <button id="crop-aspect-reset-btn" class="btn"
                    style="padding: 6px 12px; font-size: 13px;">Reset</button>
            </div>

            <div class="crop-canvas-container">
                <canvas id="crop-canvas" width="800" height="600"></canvas>
            </div>
            <!-- Hidden input fields for storing crop values -->
            <input type="hidden" id="crop-left" />
            <input type="hidden" id="crop-right" />
            <input type="hidden" id="crop-top" />
            <input type="hidden" id="crop-bottom" />
            <div class="modal-actions">
                <button id="crop-cancel-btn" class="btn">Cancel</button>
                <button id="crop-clear-btn" class="btn">Clear Crop</button>
                <button id="crop-save-btn" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Context menu for canvas -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item context-menu-parent">
            <span>Add Node</span>
            <svg class="context-menu-arrow" width="8" height="12" viewBox="0 0 8 12">
                <path d="M 1 1 L 6 6 L 1 11" fill="none" stroke="currentColor" stroke-width="2" />
            </svg>
            <!-- Submenu items populated dynamically from backend node type schemas -->
            <div class="context-menu-submenu" id="add-node-submenu">
            </div>
        </div>
    </div>

    <!-- Context menu for nodes -->
    <div id="node-context-menu" class="context-menu">
        <div class="context-menu-item" data-action="edit-config">Edit</div>
        <div class="context-menu-item" data-action="view">View Outputs</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
    </div>

    <!-- JavaScript modules -->
    <script type="module" src="/js/main.js"></script>
</body>

</html>
